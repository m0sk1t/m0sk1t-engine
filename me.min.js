/*! me 2014-02-26 */
!function(a){if(!a.me){a.me={};var b=["core","utils","primitive","assets","input"];b.forEach(function(b){a.me[b]={}})}me.core.each=function(a,b){if(a instanceof Array)for(var c=0;c<a.length;c++)b.call(a,a[c]);else if(a instanceof Object)for(var d in a)a.hasOwnProperty(d)&&b.call(a,a[d],d)},me.core.Class=function(a){var b,c=a.init||function(){};a.parent&&(c.prototype=new a.parent,c.prototype.constructor=c);for(b in a)a.hasOwnProperty(b)&&"init"!==b&&(c.prototype[b]=a[b]);return c},me.core.canvas={},me.core.layers={},me.core.init=function(a,b,c){var d=me.utils.find(a),e=0,f=0;if(d)for(e=0,f=d.length;f>e;e++)me.core.canvas[a[e]]=d[e],me.core.canvas[a[e]].width=b||document.width||document.documentElement.clientWidth,me.core.canvas[a[e]].height=c||document.height||document.documentElement.clientHeight,me.core.isCanvas(me.core.canvas[a[e]])&&(me.core.layers[a[e]]=me.core.canvas[a[e]].getContext("2d"));else for(e=0,f=a.length;f>e;e++)me.core.canvas[a[e]]=document.createElement("canvas"),me.core.canvas[a[e]].width=b||document.width||document.documentElement.clientWidth,me.core.canvas[a[e]].height=c||document.height||document.documentElement.clientHeight,me.core.layers[a[e]]=me.core.canvas[a[e]].getContext("2d")},me.core.clear=function(a){me.core.canvas[a].width=me.core.canvas[a].width},me.core.toStr=function(a){return Object.prototype.toString.call(a)},me.core.isOut=function(a,b){return a.x<0||a.y<0||a.x>me.core.canvas[b].width||a.y>me.core.canvas[b].height},me.core.distance=function(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))},me.core.isCollide=function(a,b){var c=!1;switch(a.type){case"Circle":switch(b.type){case"Point":c=me.core.circleAndPointCollision(a,b);break;case"Vector":c=me.core.circleAndLineCollision(a,b);break;case"Circle":c=me.core.circleCollision(a,b);break;case"Rectangle":c=me.core.circleAndRectangleCollision(a,b)}}return c},me.core.circleCollision=function(a,b){return Math.pow(a.radius+b.radius,2)>Math.pow(a.coord.x-b.coord.x,2)+Math.pow(a.coord.y-b.coord.y,2)},me.core.rectangleCollision=function(a,b){return a.coord.x+a.width<b.coord.x||a.coord.x>b.coord.x+b.width||a.coord.y+a.height<b.coord.y||a.coord.y>b.coord.y+b.height},me.core.circleAndPointCollision=function(a,b){return a.radius>Math.sqrt(Math.pow(a.coord.x-b.x,2)+Math.pow(a.coord.y-b.y,2))},me.core.circleAndLineCollision=function(a,b){var c={x:0,y:0};if(b.start.x===b.end.x)c.x=b.start.x,c.y=a.coord.y;else if(b.start.y===b.end.y)c.x=a.coord.x,c.y=b.start.y;else{var d=b.start.x,e=b.start.y,f=b.end.x,g=b.end.y,h=a.coord.x,i=a.coord.y;c.x=(d*Math.pow(g-e,2)+h*Math.pow(f-d,2)+(f-d)*(g-e)*(i-e))/(Math.pow(g-e,2)+Math.pow(f-d,2)),c.y=(f-d)*(h-c.x)/(g-e)+i}return a.radius>me.core.distance(a.coord,c)},me.core.circleAndRectangleCollision=function(a,b){return a.coord.x>=b.coord.x-a.radius&&a.coord.x<=b.coord.x+b.width+a.radius&&a.coord.y>=b.coord.y-a.radius&&a.coord.y<=b.coord.y+b.height+a.radius},me.core.isImage=function(a){return"[object HTMLImageElement]"===me.core.toStr(a)},me.core.isCanvas=function(a){return"[object HTMLCanvasElement]"===me.core.toStr(a)},me.core.isDrawable=function(a){return me.core.isImage(a)||me.core.isCanvas(a)},me.core.isString=function(a){return"string"==typeof a},me.core.isArray=function(a){return"[object Array]"===me.core.toStr(a)},me.core.isFunction=function(a){return"[object Function]"===me.core.toStr(a)}}(window),function(a){a.utils.find=function(b){var c=document.querySelectorAll(b);return 0===c.length?(a.utils.log("Element(s) not found!","e"),null):c},a.utils.log=function(b,c){var d=a.utils.find(["#meLog"]).item(0);if(d)if(""!==d.innerHTML)switch(c){case"m":d.innerHTML+='<span style="color:green;">'+b+"</span><br />\n\r";break;case"w":d.innerHTML+='<span style="color:yellow;">'+b+"</span><br />\n\r";break;case"e":d.innerHTML+='<span style="color:red;">'+b+"</span><br />\n\r";break;default:d.innerHTML+='<span style="color:red;">INVALID MESSAGE TYPE!</span><br />\n\r'}else switch(c){case"m":d.innerHTML='<span style="color:green;">'+b+"</span><br />\n\r";break;case"w":d.innerHTML='<span style="color:yellow;">'+b+"</span><br />\n\r";break;case"e":d.innerHTML='<span style="color:red;">'+b+"</span><br />\n\r";break;default:d.innerHTML='<span style="color:red;">INVALID MESSAGE TYPE!</span><br />\n\r'}},function(b){b.rAF=a.utils.rAF=b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||b.msRequestAnimationFrame||function(a){b.setTimeout(a,1e3/60)}}(window),a.utils.tFS=function(){document.fullscreenElement&&document.mozFullScreenElement&&document.webkitFullscreenElement?document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()},a.utils.globalize=function(b){var c=b||["find","log","rAF","tFS"];c.forEach(function(b){window[b]?window[b]=a.utils[b]:console.log(b+" already exists in global namespace")})}}(window.me),function(a){a.assets.cashe={},a.assets.callbacks=[],a.assets.loadImage=function(b,c){if(!a.assets.cashe[c]){var d=new Image;d.onload=function(){a.assets.cashe[c]=d,a.assets.isLoaded()&&a.assets.callbacks.forEach(function(a){a()})},a.assets.cashe[c]=!1,d.src=b}},a.assets.load=function(b,c){c.forEach(function(c){a.assets.loadImage(b+c,c),console.log(b+c+" loaded")})},a.assets.isLoaded=function(){var b=!0;for(var c in a.assets.cashe)a.assets.cashe.hasOwnProperty(c)&&!a.assets.cashe[c]&&(b=!1);return b},a.assets.callback=function(b){a.assets.callbacks.push(b)},a.assets.get=function(b){return a.assets.cashe[b]},a.assets.count=function(){return a.assets.cashe.length},a.assets.Tile=a.core.Class({init:function(a,b,c){return this.tileArea=b,this.img=a,this.prevPos=[0,0,c[2],c[3]],this.destArea=c,this},setPos:function(a){var b=this.getPos();return this.prevPos[0]=b.x,this.prevPos[1]=b.y,this.destArea[0]=a.x,this.destArea[1]=a.y,this},getPos:function(){return{x:this.destArea[0],y:this.destArea[1]}},draw:function(b,c){return c=void 0===c?!0:c,c&&a.core.layers[b].clearRect(this.destArea[0],this.destArea[1],this.destArea[2],this.destArea[3]),a.core.layers[b].drawImage(a.assets.get(this.img),this.tileArea[0],this.tileArea[1],this.tileArea[2],this.tileArea[3],this.destArea[0],this.destArea[1],this.destArea[2],this.destArea[3]),this}}),a.assets.Sprite=a.core.Class({init:function(b,c,d,e,f){return this.img=b,this.prevcoord=e,this.offset=d,this.coord=e,this.spriteSize=c,this.maxFrames=a.assets.get(this.img).width/this.spriteSize.W,this.currentFrame=0,this.scale=f||1,this},getCoord:function(){return{x:this.coord.x,y:this.coord.y}},appendPos:function(a){return this.prevcoord=this.getCoord(),this.coord.x+=a.x,this.coord.y+=a.y,this},setPos:function(a){return this.prevcoord=this.coord,this.coord=a,this},draw:function(b,c){return c=void 0===c?!0:c,this.currentFrame>=this.maxFrames&&(this.currentFrame=0),c&&a.core.layers[b].clearRect(this.coord.x,this.coord.y,this.spriteSize.W*this.scale,this.spriteSize.H*this.scale),a.core.layers[b].drawImage(a.assets.get(this.img),this.currentFrame*this.spriteSize.W,this.offset.x*this.spriteSize.H,this.spriteSize.W,this.spriteSize.H,this.coord.x,this.coord.y,this.spriteSize.W*this.scale,this.spriteSize.H*this.scale),this.currentFrame++,this}})}(window.me),function(a){a.primitive.Point=a.core.Class({init:function(a,b){return this.type="Point",this.x=a,this.y=b,this}}),a.primitive.Vector=a.core.Class({init:function(a,b){return this.type="Vector",this.start=a,this.end=b,this},setStart:function(a){return this.start=a,this},setEnd:function(a){return this.end=a,this},getStart:function(){return this.start},getEnd:function(){return this.end},draw:function(b){return a.core.layers[b].beginPath(),a.core.layers[b].moveTo(this.start.x,this.start.y),a.core.layers[b].lineTo(this.end.x,this.end.y),a.core.layers[b].closePath(),a.core.layers[b].stroke(),this}}),a.primitive.Circle=a.core.Class({init:function(a,b,c,d){return this.type="Circle",this.color=d,this.prevcoord=a,this.coord=a,this.radius=b,this.method=c,this},getCoord:function(){return this.coord},setCoord:function(a){return this.prevcoord=this.coord,this.coord=a,this},setRadius:function(a){return this.radius=a,this},setColor:function(a){this.color=a},draw:function(b){switch(a.core.layers[b].clearRect(this.prevcoord.x-this.radius,this.prevcoord.y-this.radius,2*this.radius,2*this.radius),a.core.layers[b].beginPath(),a.core.layers[b].arc(this.coord.x,this.coord.y,this.radius,0,2*Math.PI,!0),this.method){case"fill":a.core.layers[b].fillStyle=this.color,a.core.layers[b].fill();break;case"stroke":a.core.layers[b].strokeStyle=this.color,a.core.layers[b].stroke();break;default:a.utils.log('Unknown draw type "'+this.method+'" in class "'+this.type+'"',"e")}return this}}),a.primitive.Rect=a.core.Class({init:function(a,b,c,d){return this.type="Rect",this.color=c,this.prevcoord=a,this.coord=a,this.width=b.x,this.height=b.y,this.halfWidth=this.width/2,this.halfHeight=this.height/2,this.method=d,this},getCoord:function(){return this.coord},getSize:function(){return{x:this.width,y:this.height}},setCoord:function(a){return this.prevcoord=this.coord,this.coord=a,this},setSize:function(a){return this.width=a.x,this.height=a.y,this},draw:function(b){switch(a.core.layers[b].clearRect(this.prevcoord.x-(this.coord.x-this.prevcoord.x),this.prevcoord.y-(this.coord.y-this.prevcoord.y),this.width,this.height),this.method){case"fill":a.core.layers[b].fillStyle=this.color,a.core.layers[b].fillRect(this.coord.x,this.coord.y,this.width,this.height);break;case"stroke":a.core.layers[b].strokeStyle=this.color,a.core.layers[b].strokeRect(this.coord.x,this.coord.y,this.width,this.height);break;default:a.utils.log('Unknown draw type "'+this.method+'" in class "'+this.type+'"',"e")}return this}}),a.primitive.Polygon=a.core.Class({init:function(b,c,d,e){this.type="Polygon",this.pts=c,this.method=e,a.core.layers[b].fillStyle=d,a.core.layers[b].beginPath(),a.core.layers[b].moveTo(this.pts[0].x,this.pts[0].y);for(var f=1,g=this.pts.length;g>f;f++)a.core.layers[b].lineTo(this.pts[f].x,this.pts[f].y);switch(a.core.layers[b].closePath(),this.method){case"fill":a.core.layers[b].fill();break;case"stroke":a.core.layers[b].stroke()}}}),a.primitive.TextFill=function(){return this.draw=function(b,c,d,e,f,g){return a.core.layers[b].fillStyle=f,a.core.layers[b].strokeStyle=g,this.fontSize=Number(c[0]),c[0]+="px",a.core.layers[b].font=c.join(" "),a.core.layers[b].clearRect(e.x,e.y-this.fontSize,d.toString().length*this.fontSize,this.fontSize),a.core.layers[b].fillText(d,e.x,e.y),this},this},a.primitive.TextStroke=function(){return this.draw=function(b,c,d,e,f){return a.core.layers[b].strokeStyle=f,a.core.layers[b].font=aFont,a.core.layers[b].strokeText(d,e.x,e.y),this},this}}(window.me),function(a){a.input.mX=0,a.input.mY=0,a.input.keys=[],a.input.pressedKeys=[],function(){a.input.keys.left=37,a.input.keys.up=38,a.input.keys.right=39,a.input.keys.down=40,a.input.keys.w=87,a.input.keys.a=65,a.input.keys.s=83,a.input.keys.d=68,a.input.keys.bs=8,a.input.keys.tab=9,a.input.keys.enter=13,a.input.keys.shift=16,a.input.keys.ctrl=17,a.input.keys.alt=18,a.input.keys.pause=19,a.input.keys.capslock=20,a.input.keys.esc=27,a.input.keys.space=32,a.input.keys.pageup=33,a.input.keys.pagedown=34,a.input.keys.end=35,a.input.keys.home=36,a.input.keys.insert=45,a.input.keys["delete"]=46,a.input.keys.leftwnd=91,a.input.keys.rightwnd=92,a.input.keys.select=93,a.input.keys.mul=106,a.input.keys.plus=107,a.input.keys.minus=109,a.input.keys.point=110,a.input.keys["/"]=111,a.input.keys.num=144,a.input.keys.scroll=145,a.input.keys[";"]=186,a.input.keys["="]=187,a.input.keys[","]=188,a.input.keys["-"]=189,a.input.keys["."]=190,a.input.keys["/"]=191,a.input.keys["`"]=192,a.input.keys["["]=219,a.input.keys["\\"]=220,a.input.keys["]"]=221,a.input.keys["'"]=222;for(var b in a.input.keys)a.input.keys.hasOwnProperty(b)&&(a.input.pressedKeys[a.input.keys[b]]=!1)}(),a.input.isPressed=function(b){return a.input.pressedKeys[a.input.keys[b]]},a.input.setKey=function(b,c){a.input.pressedKeys[b]=Boolean(c)},document.addEventListener("keydown",function(b){a.input.setKey(b.keyCode,!0)}),document.addEventListener("keyup",function(b){a.input.setKey(b.keyCode,!1)}),a.input.mPos=function(b){b=b||window.event,a.input.mX=b.pageX||b.clientX,a.input.mY=b.pageY||b.clientY}}(window.me,document);