/**
 * @author m0sk1t
 */
(function(e){e.assets.cashe={};e.assets.callbacks=[];e.assets.loadImage=function(t,n){if(!e.assets.cashe[n]){var r=new Image;r.onload=function(){e.assets.cashe[n]=r;if(e.assets.isLoaded()){e.assets.callbacks.forEach(function(e){e()})}};e.assets.cashe[n]=false;r.src=t}};e.assets.load=function(t,n){n.forEach(function(n){e.assets.loadImage(t+n,n);console.log(t+n+" loaded")})};e.assets.isLoaded=function(){var t=true;for(var n in e.assets.cashe){if(e.assets.cashe.hasOwnProperty(n)&&!e.assets.cashe[n]){t=false}}return t};e.assets.callback=function(t){e.assets.callbacks.push(t)};e.assets.get=function(t){return e.assets.cashe[t]};e.assets.count=function(){return e.assets.cashe.length};e.assets.Tile=e.core.Class({init:function(e,t,n){this.tileArea=t;this.img=e;this.prevPos=[0,0,n[2],n[3]];this.destArea=n;return this},setPos:function(e){var t=this.getPos();this.prevPos[0]=t.x;this.prevPos[1]=t.y;this.destArea[0]=e.x;this.destArea[1]=e.y;return this},getPos:function(){return{x:this.destArea[0],y:this.destArea[1]}},draw:function(t,n){n=n==undefined?true:n;if(n){e.core.layers[t].clearRect(this.prevPos[0],this.prevPos[1],this.prevPos[2],this.prevPos[3])}e.core.layers[t].drawImage(e.assets.get(this.img),this.tileArea[0],this.tileArea[1],this.tileArea[2],this.tileArea[3],this.destArea[0],this.destArea[1],this.destArea[2],this.destArea[3]);return this}});e.assets.Sprite=e.core.Class({init:function(t,n,r,i){this.img=t;this.prevcoord=i;this.offset=r;this.coord=i;this.spriteSize=n;this.maxFrames=e.assets.get(this.img).width/this.spriteSize.W;this.currentFrame=0;return this},getCoord:function(){return{x:this.coord.x,y:this.coord.y}},appendPos:function(e){this.prevcoord=this.getCoord();this.coord.x+=e.x;this.coord.y+=e.y;return this},setPos:function(e){this.prevcoord=this.coord;this.coord=e},draw:function(t){if(this.currentFrame>=this.maxFrames){this.currentFrame=0}e.core.layers[t].clearRect(this.coord.x,this.coord.y,this.spriteSize.W,this.spriteSize.H);e.core.layers[t].drawImage(e.assets.get(this.img),this.currentFrame*this.spriteSize.W,this.offset.x*this.spriteSize.H,this.spriteSize.W,this.spriteSize.H,this.coord.x,this.coord.y,this.spriteSize.W,this.spriteSize.H);this.currentFrame++;return this}})})(window.me);(function(e){if(!e.me){e.me={};var t=["core","utils","primitive","assets","input"];t.forEach(function(t){e.me[t]={}})}me.core.each=function(e,t){if(e instanceof Array)for(var n=0;n<e.length;n++)t.call(e,e[n]);else if(e instanceof Object)for(field in e)if(e.hasOwnProperty(field))t.call(e,e[field],field)};me.core.Class=function(e){var t=e.init||function(){},n;if(e.parent){t.prototype=new e.parent;t.prototype.constructor=t}for(n in e)if(e.hasOwnProperty(n)&&n!=="init"){t.prototype[n]=e[n]}return t};me.core.canvas={};me.core.layers={};me.core.init=function(e,t,n){var r=me.utils.find(e);var i=0,s=0;if(r){for(i=0,s=r.length;i<s;i++){me.core.canvas[e[i]]=r[i];me.core.canvas[e[i]].width=t||document.width||document.documentElement.clientWidth;me.core.canvas[e[i]].height=n||document.height||document.documentElement.clientHeight;if(me.core.isCanvas(me.core.canvas[e[i]])){me.core.layers[e[i]]=me.core.canvas[e[i]].getContext("2d")}}}else{for(i=0,s=e.length;i<s;i++){me.core.canvas[e[i]]=document.createElement("canvas");me.core.canvas[e[i]].width=t||document.width||document.documentElement.clientWidth;me.core.canvas[e[i]].height=n||document.height||document.documentElement.clientHeight;me.core.layers[e[i]]=me.core.canvas[e[i]].getContext("2d")}}};me.core.clear=function(e){me.core.canvas[e].width=me.core.canvas[e].width};me.core.toStr=function(e){return Object.prototype.toString.call(e)};me.core.isOut=function(e,t){return e.x<0||e.y<0||e.x>me.core.canvas[t].width||e.y>me.core.canvas[t].height};me.core.distance=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))};me.core.isCollide=function(e,t){var n=false;switch(e["type"]){case"Circle":{switch(t["type"]){case"Point":n=me.core.circleAndPointCollision(e,t);break;case"Vector":n=me.core.circleAndLineCollision(e,t);break;case"Circle":n=me.core.circleCollision(e,t);break;case"Rectangle":n=me.core.circleAndRectangleCollision(e,t);break}}}return n};me.core.circleCollision=function(e,t){return Math.pow(e.radius+t.radius,2)>Math.pow(e.coord.x-t.coord.x,2)+Math.pow(e.coord.y-t.coord.y,2)};me.core.rectangleCollision=function(e,t){return e.coord.x+e.width<t.coord.x||e.coord.x>t.coord.x+t.width||e.coord.y+e.height<t.coord.y||e.coord.y>t.coord.y+t.height};me.core.circleAndPointCollision=function(e,t){return e.radius>Math.sqrt(Math.pow(e.coord.x-t.x,2)+Math.pow(e.coord.y-t.y,2))};me.core.circleAndLineCollision=function(e,t){var n={x:0,y:0};if(t.start.x===t.end.x){n.x=t.start.x;n.y=e.coord.y}else if(t.start.y===t.end.y){n.x=e.coord.x;n.y=t.start.y}else{var r=t.start.x,i=t.start.y,s=t.end.x,o=t.end.y,u=e.coord.x,a=e.coord.y;n.x=(r*Math.pow(o-i,2)+u*Math.pow(s-r,2)+(s-r)*(o-i)*(a-i))/(Math.pow(o-i,2)+Math.pow(s-r,2));n.y=(s-r)*(u-n.x)/(o-i)+a}return e.radius>me.core.distance(e.coord,n)};me.core.circleAndRectangleCollision=function(e,t){return e.coord.x>=t.coord.x-e.radius&&e.coord.x<=t.coord.x+t.width+e.radius&&e.coord.y>=t.coord.y-e.radius&&e.coord.y<=t.coord.y+t.height+e.radius};me.core.isImage=function(e){return me.core.toStr(e)==="[object HTMLImageElement]"};me.core.isCanvas=function(e){return me.core.toStr(e)==="[object HTMLCanvasElement]"};me.core.isDrawable=function(e){return me.core.isImage(e)||me.core.isCanvas(e)};me.core.isString=function(e){return typeof e==="string"};me.core.isArray=function(e){return me.core.toStr(e)==="[object Array]"};me.core.isFunction=function(e){return me.core.toStr(e)==="[object Function]"}})(window);(function(e,t){e.input.mX=0;e.input.mY=0;e.input.keys=[];e.input.pressedKeys=[];(function(){e.input.keys["left"]=37;e.input.keys["up"]=38;e.input.keys["right"]=39;e.input.keys["down"]=40;e.input.keys["w"]=87;e.input.keys["a"]=65;e.input.keys["s"]=83;e.input.keys["d"]=68;e.input.keys["bs"]=8;e.input.keys["tab"]=9;e.input.keys["enter"]=13;e.input.keys["shift"]=16;e.input.keys["ctrl"]=17;e.input.keys["alt"]=18;e.input.keys["pause"]=19;e.input.keys["capslock"]=20;e.input.keys["esc"]=27;e.input.keys["space"]=32;e.input.keys["pageup"]=33;e.input.keys["pagedown"]=34;e.input.keys["end"]=35;e.input.keys["home"]=36;e.input.keys["insert"]=45;e.input.keys["delete"]=46;e.input.keys["leftwnd"]=91;e.input.keys["rightwnd"]=92;e.input.keys["select"]=93;e.input.keys["mul"]=106;e.input.keys["plus"]=107;e.input.keys["minus"]=109;e.input.keys["point"]=110;e.input.keys["/"]=111;e.input.keys["num"]=144;e.input.keys["scroll"]=145;e.input.keys[";"]=186;e.input.keys["="]=187;e.input.keys[","]=188;e.input.keys["-"]=189;e.input.keys["."]=190;e.input.keys["/"]=191;e.input.keys["`"]=192;e.input.keys["["]=219;e.input.keys["\\"]=220;e.input.keys["]"]=221;e.input.keys["'"]=222;for(var t in e.input.keys)if(e.input.keys.hasOwnProperty(t)){e.input.pressedKeys[e.input.keys[t]]=false}})();e.input.isPressed=function(t){return e.input.pressedKeys[e.input.keys[t]]};e.input.setKey=function(t,n){e.input.pressedKeys[t]=Boolean(n)};document.addEventListener("keydown",function(t){e.input.setKey(t.keyCode,true)});document.addEventListener("keyup",function(t){e.input.setKey(t.keyCode,false)});e.input.mPos=function(t){t=t||window.event;e.input.mX=t.pageX||t.clientX;e.input.mY=t.pageY||t.clientY}})(window.me,document);(function(e){e.primitive.Point=e.core.Class({init:function(e,t){this.type="Point";this.x=e;this.y=t;return this}});e.primitive.Vector=e.core.Class({init:function(e,t){this.type="Vector";this.start=e;this.end=t;return this},setStart:function(e){this.start=e;return this},setEnd:function(e){this.end=e;return this},getStart:function(){return this.start},getEnd:function(){return this.end},draw:function(t){e.core.layers[t].beginPath();e.core.layers[t].moveTo(this.start.x,this.start.y);e.core.layers[t].lineTo(this.end.x,this.end.y);e.core.layers[t].closePath();e.core.layers[t].stroke();return this}});e.primitive.Circle=e.core.Class({init:function(e,t,n,r){this.type="Circle";this.color=r;this.prevcoord=e;this.coord=e;this.radius=t;this.method=n;return this},getCoord:function(){return this.coord},setCoord:function(e){this.prevcoord=this.coord;this.coord=e;return this},setRadius:function(e){this.radius=e;return this},setColor:function(e){this.color=e},draw:function(t){e.core.layers[t].clearRect(this.prevcoord.x-this.radius,this.prevcoord.y-this.radius,this.radius*2,this.radius*2);e.core.layers[t].beginPath();e.core.layers[t].arc(this.coord.x,this.coord.y,this.radius,0,Math.PI*2,true);switch(this.method){case"fill":{e.core.layers[t].fillStyle=this.color;e.core.layers[t].fill()}break;case"stroke":{e.core.layers[t].strokeStyle=this.color;e.core.layers[t].stroke()}break;default:e.utils.log('Unknown draw type "'+this.method+'" in class "'+this.type+'"',"e")}return this}});e.primitive.Rect=e.core.Class({init:function(e,t,n,r){this.type="Rect";this.color=n;this.prevcoord=e;this.coord=e;this.width=t.x;this.height=t.y;this.halfWidth=this.width/2;this.halfHeight=this.height/2;this.method=r;return this},getCoord:function(){return this.coord},getSize:function(){return{x:this.width,y:this.height}},setCoord:function(e){this.prevcoord=this.coord;this.coord=e;return this},setSize:function(e){this.width=e.x;this.height=e.y;return this},draw:function(t){e.core.layers[t].clearRect(this.prevcoord.x-(this.coord.x-this.prevcoord.x),this.prevcoord.y-(this.coord.y-this.prevcoord.y),this.width,this.height);switch(this.method){case"fill":{e.core.layers[t].fillStyle=this.color;e.core.layers[t].fillRect(this.coord.x,this.coord.y,this.width,this.height)}break;case"stroke":{e.core.layers[t].strokeStyle=this.color;e.core.layers[t].strokeRect(this.coord.x,this.coord.y,this.width,this.height)}break;default:e.utils.log('Unknown draw type "'+this.method+'" in class "'+this.type+'"',"e")}return this}});e.primitive.Polygon=e.core.Class({init:function(t,n,r,i){this.type="Polygon";this.pts=n;this.method=i;e.core.layers[t].fillStyle=r;e.core.layers[t].beginPath();e.core.layers[t].moveTo(this.pts[0].x,this.pts[0].y);for(var s=1,o=this.pts.length;s<o;s++){e.core.layers[t].lineTo(this.pts[s].x,this.pts[s].y)}e.core.layers[t].closePath();switch(this.method){case"fill":e.core.layers[t].fill();break;case"stroke":e.core.layers[t].stroke();break}}});e.primitive.TextFill=function(){this.draw=function(t,n,r,i,s,o){e.core.layers[t].fillStyle=s;e.core.layers[t].strokeStyle=o;this.fontSize=Number(n[0]);n[0]+="px";e.core.layers[t].font=n.join(" ");e.core.layers[t].clearRect(i.x,i.y-this.fontSize,r.toString().length*this.fontSize,this.fontSize);e.core.layers[t].fillText(r,i.x,i.y);return this};return this};e.primitive.TextStroke=function(){this.draw=function(t,n,r,i,s){e.core.layers[t].strokeStyle=s;e.core.layers[t].font=aFont;e.core.layers[t].strokeText(r,i.x,i.y);return this};return this}})(window.me);(function(e){e.utils.find=function(t){var n=document.querySelectorAll(t);if(n.length===0){e.utils.log("Element(s) not found!","e");return null}else{return n}};e.utils.log=function(t,n){var r=e.utils.find(["#meLog"]).item(0);if(r){if(r.innerHTML!==""){switch(n){case"m":r.innerHTML+='<span style="color:green;">'+t+"</span><br />\n\r";break;case"w":r.innerHTML+='<span style="color:yellow;">'+t+"</span><br />\n\r";break;case"e":r.innerHTML+='<span style="color:red;">'+t+"</span><br />\n\r";break;default:r.innerHTML+='<span style="color:red;">INVALID MESSAGE TYPE!</span><br />\n\r';break}}else{switch(n){case"m":r.innerHTML='<span style="color:green;">'+t+"</span><br />\n\r";break;case"w":r.innerHTML='<span style="color:yellow;">'+t+"</span><br />\n\r";break;case"e":r.innerHTML='<span style="color:red;">'+t+"</span><br />\n\r";break;default:r.innerHTML='<span style="color:red;">INVALID MESSAGE TYPE!</span><br />\n\r';break}}}};(function(t){t.rAF=e.utils.rAF=t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){t.setTimeout(e,1e3/60)}})(window);e.utils.tFS=function(){if(!!document.fullscreenElement&&!!document.mozFullScreenElement&&!!document.webkitFullscreenElement){if(document.documentElement.requestFullscreen){document.documentElement.requestFullscreen()}else if(document.documentElement.mozRequestFullScreen){document.documentElement.mozRequestFullScreen()}else if(document.documentElement.webkitRequestFullscreen){document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}}else{if(document.cancelFullScreen){document.cancelFullScreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}}};e.utils.globalize=function(t){var n=t||["find","log","rAF","tFS"];n.forEach(function(t){if(!!window[t]){window[t]=e.utils[t]}else{console.log(t+" already exists in global namespace")}})}})(window.me)
